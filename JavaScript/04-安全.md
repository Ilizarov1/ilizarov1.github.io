# 1. XSS

## 1.1 什么

- 跨站脚本攻击
- 注入恶意代码
- 本质是没有对恶意代码进行过滤

## 1.2 分类

- 存储型：恶意代码提交到数据库中，用户请求时，将其拼接为html发给了客户
- 反射型：构建特殊URL，服务端从URL中获取数据，拼接到HTML后返回，导致恶意代码执行
- DOM型：构建特殊URL，用户打开网站后导致，JS脚本从URL获取数据，导致恶意代码执行

## 1.3 防范

- 输入端过滤：在输入时进行处理转义，效果不好，因为一个数据可能要在多个地方使用，无法准确判断哪些地方要转义回去
- 针对存储型和反射型：
  - 纯前端渲染，将代码和数据分开
    - 浏览器先加载一个静态 HTML，此 HTML 中不包含任何跟业务相关的数据。
    - 然后浏览器执行 HTML 中的 JavaScript。
    - JavaScript 通过 Ajax 加载业务数据，调用 DOM API 更新到页面上。
  - 对HTML做充分的转义
- 针对DOM型：
  - js代码不够严谨
  - 主要防范：.innerHTML`、`.outerHTML`、`document.write()
  - DOM 中的内联事件监听器，如 `location`、`onclick`、`onerror`、`onload`、`onmouseover` 等，
  - `<a>` 标签的 `href` 属性，
  - JavaScript 的 `eval()`、`setTimeout()`、`setInterval()` 等，都能把字符串作为代码运行。如果不可信的数据拼接到字符串中传递给这些 API，很容易产生安全隐患，请务必避免。

# 2. CSP（内容安全策略

## 2.1 本质

- 建立白名单，告诉浏览器哪些资源可以加载

## 2.2 方法

- 设置HTTP首部中的content-security-policy
- 设置meta标签的方式

# 3. CSRF

## 3.1 什么

- CSRF 攻击指的是跨站请求伪造攻击，攻击者诱导用户进入一个第三方网站，然后该网站向被攻击网站发送跨站请求。如果用户在被攻击网站中保存了登录状态，那么攻击者就可以利用这个登录状态，绕过后台的用户验证，冒充用户向服务器执行一些操作。

## 3.2 分类

- GET：利用\<img>
- POST：利用表单
- 链接类型：利用链接

## 3.3 特点

- 攻击一般发起在第三方网站，而不是被攻击的网站。被攻击的网站无法防止攻击发生。

- 攻击利用受害者在被攻击网站的登录凭证，冒充受害者提交操作；而不是直接窃取数据。

- 整个过程攻击者并不能获取到受害者的登录凭证，仅仅是“冒用”。

- 跨站请求可以用各种方式：图片URL、超链接、CORS、Form提交等等。部分请求方式可以直接嵌入在第三方论坛、文章中，难以进行追踪。

## 3.4 对策

- 同源检测：根据http中的origin, referer头，拒绝外域请求
- CSRF TOKEN：服务器向用户发送token, 再次请求时加入token，需要遍历dom树，给每一个链接表单添加token
- 双重cookie：服务器在用户访问网站页面时，向请求域名注入一个Cookie，内容为随机字符串，然后当用户再次向服务器发送请求的时候，从 cookie 中取出这个字符串，添加到 URL 参数中，然后服务器通过对 cookie 中的数据和参数中的数据进行比较，来进行验证。使用这种方式是**利用了攻击者只能利用 cookie，但是不能访问获取 cookie 的特点**。并且这种方法比 CSRF Token 的方法更加方便，并且不涉及到分布式访问的问题。这种方法的缺点是如果网站存在 XSS 漏洞的，那么这种方式会失效。同时这种方式不能做到子域名的隔离。
- 设置 Samesite：在设置 cookie 属性的时候设置 Samesite ，限制 cookie 不能作为被第三方使用，从而可以避免被攻击者利用。Samesite 一共有两种模式，一种是严格模式，在严格模式下 cookie 在任何情况下都不可能作为第三方 Cookie 使用，在宽松模式下，cookie 可以被请求是 GET 请求，且会发生页面跳转的请求所使用。
  - 将 Samesite 设为 strict ，这种称为严格模式，表示这个 cookie 在任何情况下都不可能作为第三方 cookie。
  - 将 Samesite 设为 Lax ，这种模式称为宽松模式，如果这个请求是个 GET 请求，并且这个请求改变了当前页面或者打开了新的页面，那么这个 cookie 可以作为第三方 cookie，其余情况下都不能作为第三方 cookie。
  - 使用这种方法的缺点是，因为它不支持子域，所以子域没有办法与主域共享登录信息，每次转入子域的网站，都回重新登录。还有一个问题就是它的兼容性不够好。

# 4. 点击劫持

- 点击劫持是一种视觉欺骗的攻击手段，攻击者将需要攻击的网站通过 iframe 嵌套的方式嵌入自己的网页中，并将 iframe 设置为透明，在页面中透出一个按钮诱导用户点击。

- 我们可以在 http 相应头中设置 X-FRAME-OPTIONS 来防御用 iframe 嵌套的点击劫持攻击。通过不同的值，可以规定页面在特定的一些情况才能作为 iframe 来使用。

# 5. SQL注入

- SQL 注入攻击指的是攻击者在 HTTP 请求中注入恶意的 SQL 代码，服务器使用参数构建数据库 SQL 命令时，恶意 SQL 被一起构造，破坏原有 SQL 结构，并在数据库中执行，达到编写程序时意料之外结果的攻击行为。